<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PWA</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .test-button {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        .status.success { background: rgba(76, 175, 80, 0.3); }
        .status.error { background: rgba(244, 67, 54, 0.3); }
        .status.info { background: rgba(33, 150, 243, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PWA</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è PWA AssistentNUOS</p>
        
        <div id="status" class="status info">
            üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
        </div>
        
        <div>
            <button class="test-button" onclick="checkServiceWorker()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å SW</button>
            <button class="test-button" onclick="checkCacheVersion()">–í–µ—Ä—Å–∏—è –∫–µ—à–∞</button>
            <button class="test-button" onclick="forceUpdate()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</button>
            <button class="test-button" onclick="testNotifications()">–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</button>
            <button class="test-button" onclick="clearStorage()">–û—á–∏—Å—Ç–∏—Ç—å storage</button>
            <button class="test-button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #888">[${timestamp}]</span> ${message}`;
            log.appendChild(logEntry);
            log.scrollTop = log.scrollHeight;
            
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        async function checkServiceWorker() {
            try {
                addLog('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker...');
                
                if (!('serviceWorker' in navigator)) {
                    addLog('‚ùå Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    updateStatus('Service Worker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                    return;
                }
                
                const registration = await navigator.serviceWorker.getRegistration();
                if (!registration) {
                    addLog('‚ùå Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
                    updateStatus('Service Worker –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                addLog(`‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${registration.scope}`);
                addLog(`üìä –ê–∫—Ç–∏–≤–Ω—ã–π: ${registration.active ? '–î–∞' : '–ù–µ—Ç'}`);
                addLog(`üìä –û–∂–∏–¥–∞—é—â–∏–π: ${registration.waiting ? '–î–∞' : '–ù–µ—Ç'}`);
                addLog(`üìä –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π—Å—è: ${registration.installing ? '–î–∞' : '–ù–µ—Ç'}`);
                
                updateStatus('Service Worker —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ SW: ${error.message}`);
                updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Service Worker', 'error');
            }
        }
        
        async function checkCacheVersion() {
            try {
                addLog('üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –∫–µ—à–∞...');
                
                const savedVersion = localStorage.getItem('pwa-cache-version');
                addLog(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: ${savedVersion || '–ù–µ –Ω–∞–π–¥–µ–Ω–∞'}`);
                
                const cacheNames = await caches.keys();
                addLog(`üìä –ù–∞–π–¥–µ–Ω–æ –∫–µ—à–µ–π: ${cacheNames.length}`);
                
                cacheNames.forEach(name => {
                    addLog(`üì¶ –ö–µ—à: ${name}`);
                });
                
                updateStatus(`–í–µ—Ä—Å–∏—è –∫–µ—à–∞: ${savedVersion || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞'}`, 'info');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞: ${error.message}`);
                updateStatus('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–µ—à–∞', 'error');
            }
        }
        
        async function forceUpdate() {
            try {
                addLog('üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è...');
                
                const registration = await navigator.serviceWorker.getRegistration();
                if (!registration) {
                    addLog('‚ùå Service Worker –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    return;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                if (registration.active) {
                    registration.active.postMessage({ type: 'FORCE_UPDATE' });
                    addLog('üì§ –ö–æ–º–∞–Ω–¥–∞ FORCE_UPDATE –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
                }
                
                // –¢–∞–∫–∂–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                await registration.update();
                addLog('üîÑ –ó–∞–ø—Ä–æ—à–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                
                updateStatus('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ', 'info');
                
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: ${error.message}`);
                updateStatus('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
            }
        }
        
        function testNotifications() {
            addLog('üîî –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤
            setTimeout(() => {
                showTestNotification('–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'info');
            }, 500);
            
            setTimeout(() => {
                showTestNotification('–ö–µ—à –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
            }, 1500);
            
            updateStatus('–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–ø—É—â–µ–Ω', 'info');
        }
        
        function showTestNotification(message, type) {
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 300px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
            
            addLog(`üîî –ü–æ–∫–∞–∑–∞–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: ${message}`);
        }
        
        function clearStorage() {
            try {
                localStorage.removeItem('pwa-cache-version');
                addLog('üóëÔ∏è localStorage –æ—á–∏—â–µ–Ω');
                updateStatus('Storage –æ—á–∏—â–µ–Ω', 'success');
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ storage: ${error.message}`);
                updateStatus('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ storage', 'error');
            }
        }
        
        function clearLog() {
            log.innerHTML = '';
            addLog('üìã –õ–æ–≥ –æ—á–∏—â–µ–Ω');
        }
        
        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('message', (event) => {
                if (event.data) {
                    addLog(`üì® –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç SW: ${JSON.stringify(event.data)}`);
                    
                    if (event.data.type === 'CACHE_UPDATED') {
                        updateStatus(`–ö–µ—à –æ–±–Ω–æ–≤–ª–µ–Ω –¥–æ –≤–µ—Ä—Å–∏–∏ ${event.data.version}`, 'success');
                    }
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', async () => {
            addLog('üöÄ –¢–µ—Å—Ç PWA –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            updateStatus('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'success');
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º SW
            await checkServiceWorker();
            await checkCacheVersion();
        });
    </script>
</body>
</html>
